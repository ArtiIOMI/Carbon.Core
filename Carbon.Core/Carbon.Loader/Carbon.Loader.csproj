<Project Sdk="Microsoft.NET.Sdk" DefaultTargets="Build">
	<PropertyGroup>
		<Product>Carbon.Loader</Product>
		<OutputType>Library</OutputType>
		<ProjectGuid>{3ACED109-8348-4608-9AF4-DC9B30421A8A}</ProjectGuid>
	</PropertyGroup>

	<Import Project="$(SolutionDir)msbuild\100-Common.props" />
	<Import Project="$(SolutionDir)msbuild\100-AssemblyName.props" />

	<ItemGroup>
		<!-- <PackageReference Include="ILRepack.Lib.MSBuild" Version="2.1.14" PrivateAssets="all" /> -->
		<PackageReference Include="Costura.Fody" Version="5.7.0" PrivateAssets="all" />

		<!-- Extra packages -->
		<!-- <PackageReference Include="Lib.Harmony" Version="2.2.2" /> -->

		<Reference Include="$(SolutionDir)..\Tools\HarmonyLib\Harmony\bin\Release\net48\1Harmony.dll" />
	</ItemGroup>

	<Target Name="CarbonRelease" AfterTargets="CarbonPrepareRelease">
		<Copy SourceFiles="$(OutputPath)$(Product).dll" DestinationFolder="$(c_harmony)" />
		<Copy SourceFiles="@(FilesToCopy)" DestinationFolder="$(c_lib)\%(RecursiveDir)" />
	</Target>

	<!-- ================ -->
	<!--  IL REPACK TASK  -->
	<!-- ================ -->
	<Target Name="RunILRepack" AfterTargets="RenameBuildOutput" Condition="false">
		<ItemGroup>
			<ILRepackInputAssemblies Include="$(OutputPath)*.dll" />
			<ILRepackAllLibPath Include="$(OutputPath)" />
			<ILRepackAllLibPath Include="$(SolutionDir)..\Rust\$(FullNameOS)\RustDedicated_Data\Managed" />
		</ItemGroup>

		<ILRepack Parallel="true" Internalize="true" DebugInfo="true" AllowDuplicateResources="false" InputAssemblies="@(ILRepackInputAssemblies)" LibraryPath="@(ILRepackAllLibPath)" TargetKind="SameAsPrimaryAssembly" OutputFile="$(OutputPath)$(Product)$(TargetExt)" />
	</Target>
</Project>